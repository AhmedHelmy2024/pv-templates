<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Merging - PV LOGO</title>
    <style>
        /* أسلوب الصفحة هنا */
    </style>
</head>
<body>
    <h1>IMAGE MERGI - PV LOGO </h1>

    <label for="image1Input">Choose base image:</label>
    <input type="file" id="image1Input" accept="image/*" title="Choose the base image">

    <!-- استخدمت div لاستضافة القائمة المنسدلة -->
    <div id="templateDropdownContainer">
        <label for="templateSelect">Choose template:</label>
        <select id="templateSelect"></select>
    </div>

    <div class="button-container">
        <button onclick="mergeImages()">Merge Images</button>
        <a id="downloadLink" download="merged_image.png">
            <button>Download Merged Image</button>
        </a>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        let baseImage;
        let templateImage;

        // قمت بتحديث وظيفة الدمج لتحميل القالب من list.json
        function mergeImages() {
            const image1Input = document.getElementById('image1Input');
            const templateSelect = document.getElementById('templateSelect');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            if (!image1Input.files[0] || !templateImage) {
                console.error('Please select both base image and template.');
                return;
            }

            const reader1 = new FileReader();
            reader1.onload = function (e) {
                baseImage = new Image();
                baseImage.src = e.target.result;

                baseImage.onload = function () {
                    canvas.width = baseImage.width;
                    canvas.height = baseImage.height;
                    ctx.drawImage(baseImage, 0, 0);

                    // قمت بتحديث الطريقة التي يتم بها استدعاء القالب من list.json
                    templateImage = new Image();
                    templateImage.src = 'https://ahmedhelmy2024.github.io/pv-templates/' + templateSelect.value;

                    templateImage.onload = function () {
                        ctx.drawImage(templateImage, 0, 0, baseImage.width, baseImage.height);
                        saveMergedImage();
                    };
                };
            };

            reader1.readAsDataURL(image1Input.files[0]);
        }

        // لم يتغير هنا شيء
        function saveMergedImage() {
            const canvas = document.getElementById('canvas');
            const downloadLink = document.getElementById('downloadLink');

            const dataURL = canvas.toDataURL('image/png');
            downloadLink.href = dataURL;
            downloadLink.style.display = 'block';
            console.log('Images merged successfully.');
        }

        // قمت بإضافة هذه الوظيفة لتحميل list.json وملء القائمة المنسدلة
        function loadTemplates() {
            const templateSelect = document.getElementById('templateSelect');

            fetch('https://ahmedhelmy2024.github.io/pv-templates/list.json')
                .then(response => response.json())
                .then(data => {
                    data.template.forEach(template => {
                        const option = document.createElement('option');
                        option.value = template;
                        option.textContent = template;
                        templateSelect.appendChild(option);
                    });
                })
                .catch(error => console.error('Error loading templates:', error));
        }

        // قمت بتحديد هذا الحدث عند تحميل الصفحة لتحميل list.json وملء القائمة المنسدلة
        window.onload = function () {
            loadTemplates();
        };
    </script>

    <h6>Programmed by Ahmed Helmy</h6>
</body>
</html>
